Bootstrap: docker
From: debian:bullseye

%files
    ../kmc/KMC3.linux/kmc /kmc/kmc
    ../kmc/KMC3.linux/kmc_tools /kmc/kmc_tools
	kmc_vlmc /kmc-vlmc/kmc_vlmc
	KMC /kmc-vlmc/KMC
	stxxl /kmc-vlmc/stxxl
	CLI11 /kmc-vlmc/CLI11
	cereal /kmc-vlmc/cereal
	CMakeLists.txt /kmc-vlmc/CMakeLists.txt

%post
	apt-get update -y && apt-get install -y cmake build-essential g++ git gcc libtbb-dev libgomp1
	echo 'deb http://deb.debian.org/debian testing main' >> /etc/apt/sources.list
    apt update -y
    apt install -y gcc g++

	mkdir -p /kmc-vlmc/build
	cd /kmc-vlmc/build/

	mkdir -p /kmc-vlmc/build/fasta /kmc-vlmc/build/tmp /kmc-vlmc/build/results

	cmake -DCMAKE_BUILD_TYPE=Release ..
	make

	cp /kmc/kmc .
	cp /kmc/kmc_tools .

%environment
	export PATH="/kmc-vlmc/build/kmc_vlmc/:$PATH"

%test
	cd /kmc-vlmc/build/kmc_vlmc/tests
	echo "Running tests"
	#./kmer_tests

%runscript
    cd /kmc-vlmc/build/
	/kmc-vlmc/build/build_vlmc $*
